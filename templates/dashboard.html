{% extends "base.html" %}
{% block title %}Dashboard de Seguridad{% endblock %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}" defer></script>
{% endblock %}

{% block content %}

<section class="dashboard-header">
  <h1>ğŸ” Dashboard de Seguridad</h1>
  <p>AnÃ¡lisis automÃ¡tico de registros de seguridad</p>
  <p id="date-warning" class="warning" style="display:none; margin-top:8px">
    âš ï¸ Este log no incluye fechas completas (aÃ±o/zona horaria). El filtrado temporal es orientativo.
  </p>
</section>

<section class="dashboard-grid">

  <!-- 1ï¸âƒ£ RESUMEN GENERAL -->
  <section class="card small summary">
    <div class="card-header">
      <h2>ğŸ“Š Resumen general</h2>
      <button class="info-btn" onclick="openAnalysisInfo()">â„¹ï¸</button>
    </div>

    <p class="log-info">
      ğŸ“„ Archivo analizado:
      <strong id="log-name">{{ log_name }}</strong>
    </p>

    <p class="log-stats">
      ğŸ“‘ LÃ­neas totales: <strong>{{ log_stats.total_lines }}</strong><br />
      âœ… LÃ­neas analizadas: <strong>{{ log_stats.parsed_lines }}</strong><br />
      ğŸ—‘ï¸ LÃ­neas no relevantes: <strong>{{ log_stats.discarded_lines }}</strong>
    </p>

    <p>Total de intentos detectados</p>
    <p id="total" class="big-number">{{ total_attempts }}</p>

  </section>
  

    <!-- 4ï¸âƒ£ USUARIOS MÃS ATACADOS -->
  <a href="{{ url_for('hosts.hosts') }}" class="card small">
    <h2>ğŸ‘¤ Usuarios mÃ¡s atacados</h2>
    <ul id="users" class="list preview"></ul>
  </a>

  <!-- 2ï¸âƒ£ HOSTS MÃS AGRESIVOS -->
  <section class="card wide">
    <div class="card-header">
      <h2>ğŸŒ Hosts mÃ¡s agresivos</h2>
      <a href="{{ url_for('hosts.hosts') }}" class="link-detail">Ver detalle â†’</a>
    </div>
    <ul id="rhosts" class="list"></ul>
  </section>

  <!-- 3ï¸âƒ£ GRÃFICA HOSTS -->
  <a href="{{ url_for('graficas.graficas') }}" class="card chart">
    <h2>ğŸ“ˆ Top 5 Hosts mÃ¡s agresivos</h2>
    <canvas id="hostsChart"></canvas>
  </a>
  

  <!-- 5ï¸âƒ£ EXPORTACIÃ“N -->
  <a href="{{ url_for('export.export') }}" class="card small export">
    <h2>â¬‡ ExportaciÃ³n</h2>
    <p>Descarga de informes e inteligencia</p>
  </a>

</section>

<!-- ğŸ”¹ MODAL EXPLICATIVO -->
<div id="analysisModal" class="modal hidden">
  <div class="modal-content">
    <h3>â„¹ï¸ Â¿CÃ³mo interpretar este anÃ¡lisis?</h3>
    <p>
      El archivo analizado contiene <strong>{{ log_stats.total_lines }}</strong> lÃ­neas,
      de las cuales Ãºnicamente <strong>{{ log_stats.parsed_lines }}</strong> corresponden
      a eventos relevantes de seguridad (fallos de autenticaciÃ³n).
    </p>
    <p>
      El resto (<strong>{{ log_stats.discarded_lines }}</strong>) se descartan
      intencionadamente al tratarse de ruido o eventos normales del sistema,
      simulando el comportamiento de un entorno real.
    </p>
    <button onclick="closeAnalysisInfo()">Cerrar</button>
  </div>
</div>

{% endblock %}
