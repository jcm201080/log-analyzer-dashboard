{% extends "base.html" %} {% block title %}Dashboard de Seguridad{% endblock %}
{% block head %} {{ super() }}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/dashboard.css') }}"
/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script
  src="{{ url_for('static', filename='js/dashboard.js') }}"
  defer
></script>
{% endblock %} {% block content %}

<section class="dashboard-header">
  <h1>ğŸ” Dashboard de Seguridad</h1>
  <p>AnÃ¡lisis automÃ¡tico de registros de seguridad</p>
</section>

{# ------------- UNKNOWN ------------- #} {% if log_type == "unknown" %}
<section class="card small warning-card">
  <h2>âš ï¸ Tipo de log no reconocido</h2>
  <p>
    El archivo cargado no coincide con los formatos de autenticaciÃ³n ni de red
    soportados por el sistema.
  </p>
  <p>Algunas secciones pueden aparecer vacÃ­as o incompletas.</p>
</section>
{% endif %} {# ------------- UNKNOWN ------------- #}

<br />

<section class="dashboard-grid">
  {# ===================== UNKNOWN ===================== #} {% if log_type ==
  "unknown" %}

  <section class="card small summary">
    <div class="card-header">
      <h2>ğŸ” AnÃ¡lisis del log cargado</h2>
      <button class="info-btn" onclick="openAnalysisInfo()">â„¹ï¸</button>
    </div>

    <p class="log-info">
      ğŸ“„ Archivo analizado:
      <strong>{{ log_name }}</strong>
    </p>

    <p class="log-stats">
      ğŸ“‘ LÃ­neas totales: <strong>{{ log_stats.total_lines }}</strong><br />
      âœ… LÃ­neas analizadas: <strong>{{ log_stats.parsed_lines }}</strong><br />
      ğŸ—‘ï¸ LÃ­neas no relevantes: <strong>{{ log_stats.discarded_lines }}</strong>
    </p>

    <p>Total de intentos detectados</p>
    <p id="total" class="big-number">â€”</p>
  </section>

  <section class="card small summary network-summary">
    <div class="card-header">
      <h2>ğŸŒ Contexto global de red</h2>
      <button
        class="info-btn"
        title="InformaciÃ³n contextual de red. El detalle por IP se consulta en la secciÃ³n Hosts."
      >
        â„¹ï¸
      </button>
    </div>

    <p class="log-info">
      ğŸ“¡ Fuente:
      <strong>TrÃ¡fico de red (Zeek / conn.log)</strong>
    </p>

    <p class="log-stats">
      ğŸ–¥ï¸ Hosts detectados: <strong>{{ network_summary.hosts }}</strong><br />
      ğŸ“Š Eventos totales: <strong>{{ network_summary.events }}</strong><br />
      ğŸ”¥ Hosts crÃ­ticos: <strong>{{ network_summary.critical }}</strong>
    </p>

    <p class="network-note">
      Indicadores obtenidos a partir de un anÃ¡lisis previo de trÃ¡fico de red.
    </p>
  </section>

  <section class="card wide">
    <div class="card-header">
      <h2>ğŸŒ Hosts mÃ¡s agresivos</h2>
      <a href="{{ url_for('hosts.hosts') }}" class="link-detail"
        >Ver detalle â†’</a
      >
    </div>
    <ul id="rhosts" class="list"></ul>
  </section>

  <a href="{{ url_for('hosts.hosts') }}" class="card small">
    <h2>ğŸ‘¤ Usuarios mÃ¡s atacados</h2>
    <ul id="users" class="list preview"></ul>
  </a>

  <section class="card wide">
    <div class="card-header">
      <h2>ğŸŒ Hosts mÃ¡s agresivos</h2>
      <a href="{{ url_for('hosts.hosts') }}" class="link-detail"
        >Ver detalle â†’</a
      >
    </div>
    <ul id="rhosts" class="list"></ul>
  </section>

  <a href="{{ url_for('graficas.graficas') }}" class="card chart">
    <h2>ğŸ“ˆ Top 5 Hosts mÃ¡s agresivos</h2>
    <canvas id="hostsChart"></canvas>
  </a>

  <a href="{{ url_for('export.export') }}" class="card small export">
    <h2>â¬‡ ExportaciÃ³n</h2>
    <p>Descarga de informes e inteligencia</p>
  </a>

  {% endif %} {# ===================== AUTH ===================== #} {% if
  log_type == "auth" %}

  <section class="card small summary">
    <div class="card-header">
      <h2>ğŸ” AnÃ¡lisis del log cargado</h2>
      <button class="info-btn" onclick="openAnalysisInfo()">â„¹ï¸</button>
    </div>

    <p class="log-info">
      ğŸ“„ Archivo analizado:
      <strong>{{ log_name }}</strong>
    </p>

    <p class="log-stats">
      ğŸ“‘ LÃ­neas totales: <strong>{{ log_stats.total_lines }}</strong><br />
      âœ… LÃ­neas analizadas: <strong>{{ log_stats.parsed_lines }}</strong><br />
      ğŸ—‘ï¸ LÃ­neas no relevantes: <strong>{{ log_stats.discarded_lines }}</strong>
    </p>

    <p>Total de intentos detectados</p>
    <p id="total" class="big-number">â€”</p>
  </section>

  <a href="{{ url_for('hosts.hosts') }}" class="card small">
    <h2>ğŸ‘¤ Usuarios mÃ¡s atacados</h2>
    <ul id="users" class="list preview"></ul>
  </a>

  <section class="card wide">
    <div class="card-header">
      <h2>ğŸŒ Hosts mÃ¡s agresivos</h2>
      <a href="{{ url_for('hosts.hosts') }}" class="link-detail"
        >Ver detalle â†’</a
      >
    </div>
    <ul id="rhosts" class="list"></ul>
  </section>

  <a href="{{ url_for('graficas.graficas') }}" class="card chart">
    <h2>ğŸ“ˆ Top 5 Hosts mÃ¡s agresivos</h2>
    <canvas id="hostsChart"></canvas>
  </a>

  <a href="{{ url_for('export.export') }}" class="card small export">
    <h2>â¬‡ ExportaciÃ³n</h2>
    <p>Descarga de informes e inteligencia</p>
  </a>

  {% endif %} {# ===================== NETWORK ===================== #} {% if
  log_type == "network" %}

  <section class="card small summary network-summary">
    <div class="card-header">
      <h2>ğŸŒ Contexto global de red</h2>
      <button
        class="info-btn"
        title="InformaciÃ³n contextual de red. El detalle por IP se consulta en la secciÃ³n Hosts."
      >
        â„¹ï¸
      </button>
    </div>

    <p class="log-info">
      ğŸ“¡ Fuente:
      <strong>TrÃ¡fico de red (Zeek / conn.log)</strong>
    </p>

    <p class="log-stats">
      ğŸ–¥ï¸ Hosts detectados: <strong>{{ network_summary.hosts }}</strong><br />
      ğŸ“Š Eventos totales: <strong>{{ network_summary.events }}</strong><br />
      ğŸ”¥ Hosts crÃ­ticos: <strong>{{ network_summary.critical }}</strong>
    </p>

    <p class="network-note">
      Indicadores obtenidos a partir de un anÃ¡lisis previo de trÃ¡fico de red.
    </p>
  </section>

  <section class="card wide">
    <div class="card-header">
      <h2>ğŸŒ Hosts mÃ¡s agresivos</h2>
      <a href="{{ url_for('hosts.hosts') }}" class="link-detail"
        >Ver detalle â†’</a
      >
    </div>
    <ul id="rhosts" class="list"></ul>
  </section>

  {% endif %}
</section>

{% if log_type == "auth" %}
<!-- ğŸ”¹ MODAL EXPLICATIVO SOLO AUTH -->
<div id="analysisModal" class="modal hidden">
  <div class="modal-content">
    <h3>â„¹ï¸ Â¿CÃ³mo interpretar este anÃ¡lisis?</h3>
    <p>
      El archivo analizado contiene
      <strong>{{ log_stats.total_lines }}</strong> lÃ­neas, de las cuales
      <strong>{{ log_stats.parsed_lines }}</strong> corresponden a eventos
      relevantes de seguridad.
    </p>
    <p>
      El resto de lÃ­neas se descartan al tratarse de actividad normal del sistema
      sin impacto en la seguridad, lo que permite centrar el anÃ¡lisis Ãºnicamente
      en eventos potencialmente sospechosos.
    </p>
    <button onclick="closeAnalysisInfo()">Cerrar</button>
  </div>
</div>

{% endif %} {% endblock %}
